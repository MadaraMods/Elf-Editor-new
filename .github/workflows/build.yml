name: Build Very Old Android Project
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Java 8
      uses: actions/setup-java@v4
      with:
        java-version: '8'
        distribution: 'temurin'

    - name: Install Old Android SDK
      run: |
        # Eski Android SDK kur
        mkdir -p android-sdk
        cd android-sdk
        
        # Build Tools 28.0.3 (Android 9 Pie için)
        wget https://dl.google.com/android/repository/build-tools_r28.0.3-linux.zip
        unzip build-tools_r28.0.3-linux.zip -d build-tools/28.0.3/
        
        # Platform 28
        wget https://dl.google.com/android/repository/platform-28_r06.zip
        unzip platform-28_r06.zip -d platforms/android-28/
        
        # Platform tools
        wget https://dl.google.com/android/repository/platform-tools_r28.0.1-linux.zip
        unzip platform-tools_r28.0.1-linux.zip
        
        export ANDROID_HOME=$PWD
        echo "ANDROID_HOME=$PWD" >> $GITHUB_ENV
        echo "$PWD/build-tools/28.0.3:$PWD/platform-tools" >> $GITHUB_PATH
        
    - name: Install Correct Gradle Version
      run: |
        # Gradle 2.14.1 kur (Android plugin 1.+ için uyumlu)
        wget https://services.gradle.org/distributions/gradle-2.14.1-bin.zip
        unzip gradle-2.14.1-bin.zip
        export PATH=$PWD/gradle-2.14.1/bin:$PATH
        echo "GRADLE_HOME=$PWD/gradle-2.14.1" >> $GITHUB_ENV
        
    - name: Fix Build Files
      run: |
        # build.gradle'daki eski plugin versiyonunu düzelt
        sed -i 's/classpath .com.android.tools.build:gradle:1.+./classpath "com.android.tools.build:gradle:1.5.0"/' build.gradle
        
        # local.properties dosyası oluştur (Android SDK yolu için)
        echo "sdk.dir=$ANDROID_HOME" > local.properties
        echo "ndk.dir=$ANDROID_HOME/ndk-bundle" >> local.properties
        
    - name: Create Gradle Wrapper
      run: |
        # Bu eski gradle ile wrapper oluştur
        gradle wrapper --gradle-version 2.14.1
        chmod +x ./gradlew
        
    - name: Build with Old Setup
      run: |
        # Eski Android toolchain ile build et
        export ANDROID_BUILD_TOOLS=$ANDROID_HOME/build-tools/28.0.3
        export ANDROID_PLATFORM=$ANDROID_HOME/platforms/android-28
        
        ./gradlew clean
        ./gradlew assembleDebug --stacktrace --no-daemon --info